# Entrega 1 - Raw e Silver

## Planejamento de Avaliação

### Objetivo
Implementar o pipeline ETL completo da camada **Raw (Bronze)** para a camada **Silver**, realizando limpeza, transformação e carga dos dados no banco de dados PostgreSQL.

### Arquitetura ETL

#### 1. Extract (Extração)
- Leitura dos dados brutos do arquivo CSV usando **PySpark**
- Inferência automática de schema
- Validação inicial da estrutura dos dados

#### 2. Transform (Transformação)

**Limpezas Aplicadas:**
- Remoção de linhas completamente vazias
- Trim (remoção de espaços) em campos de texto
- Conversão de tipos de dados:
  - Campos numéricos para `DoubleType`
  - Campos temporais para `IntegerType`
- Remoção de duplicatas baseada em chave composta: `(year, month, carrier, airport)`

**Validações:**
- Contagem de registros antes e depois
- Estatísticas descritivas dos campos numéricos
- Verificação de valores nulos em campos críticos

#### 3. Load (Carga)

**Banco de Dados PostgreSQL:**
- Schema: `silver`
- Tabela: `airline_delays`
- Chave primária composta: `(year, month, carrier, airport)`

**Processo de Carga:**
1. Criação automática do schema `silver`
2. Drop da tabela existente (se houver)
3. Criação da nova estrutura da tabela
4. Inserção em batch (1000 registros por vez) usando `execute_batch`
5. Commit das transações

### Estrutura da Tabela Silver

```sql
CREATE TABLE silver.airline_delays (
    year INTEGER NOT NULL,
    month INTEGER NOT NULL,
    carrier VARCHAR(10) NOT NULL,
    carrier_name VARCHAR(200),
    airport VARCHAR(10) NOT NULL,
    airport_name VARCHAR(200),
    arr_flights DECIMAL(10,2),
    arr_del15 DECIMAL(10,2),
    carrier_ct DECIMAL(10,2),
    weather_ct DECIMAL(10,2),
    nas_ct DECIMAL(10,2),
    security_ct DECIMAL(10,2),
    late_aircraft_ct DECIMAL(10,2),
    arr_cancelled DECIMAL(10,2),
    arr_diverted DECIMAL(10,2),
    arr_delay DECIMAL(10,2),
    carrier_delay DECIMAL(10,2),
    weather_delay DECIMAL(10,2),
    nas_delay DECIMAL(10,2),
    security_delay DECIMAL(10,2),
    late_aircraft_delay DECIMAL(10,2),
    PRIMARY KEY (year, month, carrier, airport)
);
```

### Validações Implementadas

1. **Contagem Total**: Verificação do número de registros inseridos
2. **Métricas Agregadas**:
   - Número de companhias aéreas distintas
   - Número de aeroportos distintos
   - Atraso médio geral
3. **Amostragem**: Visualização dos primeiros 5 registros

### Arquivos Relacionados

- **Pipeline ETL**: `/Transformer/etl_raw_to_silver.ipynb`
- **DDL Schema**: `/Data Layer/silver/ddl.sql`
- **Analytics**: `/Data Layer/silver/analytics.ipynb`

### Tecnologias Utilizadas

| Ferramenta | Uso |
|------------|-----|
| **PySpark** | Processamento distribuído de dados |
| **PostgreSQL** | Banco de dados relacional |
| **psycopg2** | Driver Python para PostgreSQL |
| **Docker Compose** | Orquestração do container do banco |
| **Jupyter Notebook** | Desenvolvimento e documentação do ETL |

### Configuração do Ambiente

**Docker Compose** (`docker-compose.yml`):
```yaml
services:
  postgres:
    image: postgres:15-alpine
    container_name: airline_delays_postgres
    ports:
      - "5432:5432"
    environment:
      POSTGRES_DB: airline_delays
      POSTGRES_USER: postgres
      POSTGRES_PASSWORD: postgres
```

**Iniciar Banco:**
```bash
docker-compose up -d
```

**Executar ETL:**
```bash
jupyter notebook Transformer/etl_raw_to_silver.ipynb
```

### Métricas de Qualidade

- ✅ Zero duplicatas após ETL
- ✅ Tipos de dados consistentes
- ✅ Chave primária aplicada
- ✅ Dados limpos e padronizados

### Próximos Passos

1. Criar camada **Gold** com agregações e métricas de negócio
2. Implementar modelagem dimensional (star schema)
3. Desenvolver views materializadas para otimização
4. Preparar dados para dashboard no Power BI
